sap.ui.define(["sap/mdm/mdg/libs/gov/bp/Component","mdm/mdg/gov/bps1/ext/utils/Constants","mdm/mdg/gov/bps1/ext/utils/dpi/Lookup"],function(Q,C,L){"use strict";return sap.ui.controller("mdm.mdg.gov.bps1.ext.controller.ListReportExt",{cListReport:"mdm.mdg.gov.bps1::sap.suite.ui.generic.template.ListReport.view.ListReport::BusinessPartner--listReport",cCreateButton:"mdm.mdg.gov.bps1::sap.suite.ui.generic.template.ListReport.view.ListReport::BusinessPartner--addEntry",cQuickCreateButton:"mdm.mdg.gov.bps1::sap.suite.ui.generic.template.ListReport.view.ListReport::BusinessPartner--Create",cCreateMassrequestButton:"mdm.mdg.gov.bps1::sap.suite.ui.generic.template.ListReport.view.ListReport::BusinessPartner--action::cds_c_businesspartnergovtp_srv.cds_c_businesspartnergovtp_srv_Entities::CreateMassRequest",cResultTable:"mdm.mdg.gov.bps1::sap.suite.ui.generic.template.ListReport.view.ListReport::BusinessPartner--responsiveTable",cBasicSearch:"mdm.mdg.gov.bps1::sap.suite.ui.generic.template.ListReport.view.ListReport::BusinessPartner--listReportFilter-btnBasicSearch",cListReportFilter:"mdm.mdg.gov.bps1::sap.suite.ui.generic.template.ListReport.view.ListReport::BusinessPartner--listReportFilter",onInit:function(){this.oConstants=new C();try{this.byId(this.cCreateButton).destroy();this.byId(this.cCreateMassrequestButton).destroy();}catch(e){}var t=this;var l=this.oView.byId(this.cListReport);$.each(l.getDependents(),function(i,d){if(d.isA("sap.ui.core.CommandExecution")&&d.getCommand()==="Create"){d.attachExecute(t.onCreate.bind(t));}});this.byId(this.cListReport).setIgnoredFields("MasterDataChangeProcess,MDChgProcessSrceSystem,MDChgProcessSrceObject,"+"FormOfAddressOrganization,FormOfAddressPerson,FormOfAddressGroup,"+"BankCountryKey,BankNumber,BankAccount,IBAN,BPIdentificationType,BPIdentificationNumber,BPTaxType,BPTaxNumber,"+"MDAddrValdtnServiceIsCnfgrd,StreetName,CityName,PostalCode,Country");this.byId(this.cQuickCreateButton).setAriaHasPopup("Menu");try{this.extensionAPI.invokeActions("/VerifyCloudReadiness",[],{MDChgProcessSrceObjectTypeCode:'147'}).then(function(r){if(!r[0].response.data.VerifyCloudReadiness.MDChgProcRAPBsdSwitchIsActive){t.getView().setBusy(true);try{$.each($(".sapMDialog").control(),function(i,d){d.close();});}catch(e){}sap.m.MessageBox.error(t.getView().getModel("i18n").getResourceBundle().getText("CLOUD_READY_SWITCH_OFF"),{onClose:function(){var c=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");if(c){c.toExternal({target:{shellHash:"#"}});}}});}}).catch(function(r){});}catch(e){}},onBeforeRendering:function(){L.setLookupAndCreateButtonVisibility(this);},onCreate:function(e){var t=this;var q=new Q();q.create(this.oView.byId(this.cQuickCreateButton));q.attachBusy(function(e){t.getView().setBusy(e.getParameter("busy"));});q.attachCreated(function(e){t.extensionAPI.getNavigationController().navigateInternal(e.getParameter("BusinessPartnerContext"));});},onCloseMessageDialog:function(e){e.getSource().getParent().close();},displayMessageDialog:function(o){var t=this;if(sap.ui.getCore().getMessageManager().getMessageModel().getData().length>0){sap.ui.core.Fragment.load({name:"mdm.mdg.gov.bps1.ext.fragment.MessageDialog",controller:this}).then(function(d){d.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"message");d.attachAfterClose(function(){if(o){o();}if(t.getOpenedByControl){t.getOpenedByControl().removeDependent(d);}});t.oView.addDependent(d);d.open();});}},fmtAllEnabled:function(e){var i=this.byId(this.cResultTable).getItems();return i.length>0;},fmtSelectedEnabled:function(a){var t=this;var s=t.byId(t.cResultTable).getSelectedItems();return s.length>0;},onCreateMassRequest:function(e){var t=this;var s=e.getSource();if(s){sap.ui.core.Fragment.load({name:"mdm.mdg.gov.bps1.ext.fragment.MassRequestMenu",controller:this}).then(function(f){t.oView.addDependent(f);f.openBy(s);f.attachAfterClose(function(){this.destroy();});});}},onClickMassRequestAll:function(e){var t=this;var i=t.byId(t.cResultTable).getItems();var s=sap.ui.getCore().byId(t.cBasicSearch);if(!s.getValue()){t.startProcess(i,false);}else{var r=t.oView.getModel("i18n").getResourceBundle();var m=r&&r.getText("WARNING_MESSAGE_BOX_TITLE");var M=r&&r.getText("MESSAGE_BOX_CONFIRM");var a=r&&r.getText("WARNING_SEARCH_FILTER");sap.m.MessageBox.warning(a,{title:m,styleClass:"sapUiSizeCompact",actions:[M],emphasizedAction:M,onClose:function(A){}});}},onClickMassRequestSelected:function(e){var t=this;var i=t.byId(t.cResultTable).getSelectedItems();t.startProcess(i,true);},startProcess:function(i,s){var t=this;var r=t.oView.getModel("i18n").getResourceBundle();var m=r&&r.getText("WARNING_MESSAGE_BOX_TITLE");var M=r&&r.getText("MESSAGE_BOX_CONFIRM");var a=r&&r.getText("WARNING_MESSAGE_BOX_TEXT");for(var b=0;b<i.length;b++){var p=i[b].getBindingContext().getObject();if(p.MasterDataChangeProcess!=="0"){var P=true;}if(p.MasterDataChangeProcess==="0"&&p.BusinessPartnerUUID==="00000000-0000-0000-0000-000000000000"){var A=true;}if(p.BusinessPartnerUUID!=="00000000-0000-0000-0000-000000000000"){var d=true;}}if((P||d)&&(A||(!s&&i.length>=20))){sap.m.MessageBox.warning(a,{title:m,styleClass:"sapUiSizeCompact",actions:[M,sap.m.MessageBox.Action.CANCEL],emphasizedAction:M,onClose:function(c){switch(c){case M:if(s){t.startMassRequestSelected();}else{t.startMassRequestAll();}}}});}else if((P||d)&&!A){m=r&&r.getText("ERROR_MESSAGE_NONACTIVE_PBS");a=r&&r.getText("ERROR_MESSAGE_BOX_TEXT");sap.m.MessageBox.error(a,{title:m,styleClass:"sapUiSizeCompact",actions:[M],emphasizedAction:M,onClose:function(c){}});}else{if(s){t.startMassRequestSelected();}else{t.startMassRequestAll();}}},startMassRequestAll:function(){var t=this;var a=t.byId(t.cResultTable).getBinding("items").aApplicationFilters;var f="";var F=[];var u={};var o={};var m=t.byId(t.cResultTable).getModel();var b=function(j){return m.getProperty("/#"+t.sMassEditEntitySet+"Type/"+j+"/@sap:display-format");};var d=function(j){if(j!==null){return j.toISOString().slice(0,10).replace(/-/g,"");}else{return"00000000";}};var c=function(j){if(b(j.sPath)==="Date"){var v=d(j.oValue1);if(j.oValue2){var V=d(j.oValue2);}}else{v=j.oValue1;V=j.oValue2;}if(v===true){v="X";}if(V===true){V="X";}var k="";switch(j.sOperator){case sap.ui.model.FilterOperator.StartsWith:k="CP";v=v+"*";break;case sap.ui.model.FilterOperator.EndsWith:k="CP";v="*"+v;break;case sap.ui.model.FilterOperator.Contains:k="CP";v="*"+v+"*";break;case sap.ui.model.FilterOperator.NotStartsWith:k="NP";v=v+"*";break;case sap.ui.model.FilterOperator.NotEndsWith:k="NP";v="*"+v;break;case sap.ui.model.FilterOperator.NotContains:k="NP";v="*"+v+"*";break;default:k=j.sOperator;}var l={"ATTRIBUTE":j.sPath.toUpperCase(),"SIGN":"I","OPTION":k,"LOW":v,"HIGH":V};return l;};var g=function(j){for(var k=0;k<j.length;k++){var I=j[k];if(I.aFilters){g(I.aFilters);}else{o=c(I);F.push(o);}}};for(var i=0;i<a.length;i++){var A=a[i];if(A.aFilters){g(A.aFilters);}else{o=c(A);F.push(o);}}F.splice(F.indexOf("SIBLINGENTITY/ISACTIVEENTITY"),1);F.splice(F.indexOf("ISACTIVEENTITY"),1);for(i=F.length-1;i>=0;i--){if(F[i].ATTRIBUTE==="MDCHANGEPROCESSNUMBERDISPLAY"){F.splice(i,1);}}if(F.length>0){f=JSON.stringify(F);u={"MDChangeProcessFilterValue":f};var e="/CreateMassRequestAll";var p=this.extensionAPI.invokeActions(e,[],u);p.then(function(R){t.responseMassRequest(R);});}else{var r=t.oView.getModel("i18n").getResourceBundle();var M=r&&r.getText("ERROR_MESSAGE_NONACTIVE_PBS");var s=r&&r.getText("MESSAGE_BOX_CONFIRM");var h=r&&r.getText("ERROR_MESSAGE_FILTER_TEXT");sap.m.MessageBox.error(h,{title:M,styleClass:"sapUiSizeCompact",actions:[s],emphasizedAction:s,onClose:function(j){}});}},startMassRequestSelected:function(){var t=this;var a="/CreateMassRequest";var s=this.extensionAPI.getSelectedContexts(this.cListReport);var u={"MDChgProcessNmbrOfSrceRecords":s.length};var p=this.extensionAPI.invokeActions(a,s,u);p.then(function(r){t.responseMassRequest(r);});},responseMassRequest:function(r){var t=this;var e=false;if(r[0]&&r[0].response){var m=sap.ui.getCore().getMessageManager().getMessageModel().getData();sap.ui.getCore().getMessageManager().removeAllMessages();$.each(m,function(i,M){sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({message:M.message,type:sap.ui.core.MessageType.Error,code:M.code,descriptionUrl:M.descriptionUrl}));e=M.type===sap.ui.core.MessageType.Error;});var R=r[0].response.response.statusText;if(R==="OK"&&!e){for(var a=0;a<r.length;a++){var o=r[a];if(o.response.data.MasterDataChangeProcess!=="0"){break;}}if(o&&o.response.data.MasterDataChangeProcess){t.extensionAPI.getNavigationController().navigateExternal("toManageGovProcesses",{MasterDataChangeProcess:o.response.data.MasterDataChangeProcess});}}else{t.displayMessageDialog();}}},onLookUpAndCreate:L.onLookUpAndCreate,});});
